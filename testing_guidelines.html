<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KaMPIng: Testing Guidelines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
    </script>
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeFragmentCopyButton.init()
    </script>
    <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeParagraphLink.init()
    </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="icon.svg"/></td>
  <td id="projectalign">
   <div id="projectname">KaMPIng<span id="projectnumber">&#160;0.2.0</span>
   </div>
   <div id="projectbrief">Flexible and (near) zero-overhead C++ bindings for MPI</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('testing_guidelines.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Testing Guidelines</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_2guidelines_2testing__guidelines"></a> In this document, we describe how to write tests for the KaMPIng library. We use <a href="https://google.github.io/googletest/">GoogleTest</a> for writing tests. Write <em>many</em> unit tests for your code. Check for nonsensical input and edge cases.</p>
<p>Our general philosophy is: </p><blockquote class="doxtable">
<p>&zwj;If there is no unit test for it, it does not exist. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md22"></a>
Naming and organizing tests</h1>
<p>Consider the following class:</p>
<div class="fragment"><div class="line"><span class="comment">// file: include/kamping/foo.hpp</span></div>
<div class="line"><span class="keyword">class </span>Foo {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">int</span> bar();</div>
<div class="line">    <span class="keywordtype">int</span> baz(<span class="keywordtype">int</span> x);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The corresponding test file should be named <code>tests/foo_test.cpp</code>. Inside this file, add tests using the following naming scheme: <code>TEST(FooTest, &lt;member function of Foo&gt;_&lt;description&gt;)</code>, where <code>&lt;description&gt;</code> could for example be: <code>basics</code>, <code>invalid_parameters</code>, or many others.</p>
<p>The tests for <code>Foo</code> may look like this:</p>
<div class="fragment"><div class="line"><span class="comment">// file: tests/foo_test.cpp</span></div>
<div class="line">TEST(FooTest, bar_basics) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line">TEST(Test_Helpers, mpi_datatype_enum) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line">TEST(FooTest, baz_basics) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line">TEST(FooTest, baz_negative_input) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line">TEST(FooTest, baz_invalid_parameter) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Do not forget to document what your tests are checking.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Registering tests</h1>
<p>If you have written your unit tests, you need to build the tests and register them with <code>ctest</code> so they may be executed automatically by our CI or by running <code>ctest</code> or <code>make test</code> in the build directory.</p>
<p>We provide several CMake helper functions to ease test registration. These helpers are implemented in the CMake modules <code>KampingTestHelper</code> and <code>KaTestrophe</code>, but usually you should only have to use the former.</p>
<p>To simplify building a specific test by relying on command line completion (e.g. by using <code>make test_&lt;TAB&gt;</code>), the test target names should start with the prefix <code>test_*</code>.</p>
<p>To register a test <code>tests/foo_test.cpp</code> which should not be executed using <code>mpiexec</code> use <code>kamping_register_test(...)</code> and add the following line to <code>tests/CMakeLists.txt</code></p>
<div class="fragment"><div class="line">kamping_register_test(test_foo FILES foo_test.cpp)</div>
</div><!-- fragment --><p> This links the test with KaMPIng (which transitively links MPI), adds the test target and registers the test with <code>ctest</code>.</p>
<p>If your test <code>test/foo_mpi_test.cpp</code> should be executed in parallel using MPI use <code>kamping_register_mpi_test(...)</code> like so:</p>
<div class="fragment"><div class="line">kamping_register_mpi_test(test_foo_mpi FILES foo_mpi_test.cpp CORES 1 2 4 8)</div>
</div><!-- fragment --><p> The test will be executed using 1, 2, 4 and 8 MPI ranks separately.</p>
<p>For a detailed description of the functions available for registering tests, see the reference below.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Compilation failure tests</h1>
<p>If you want to test that a certain piece of code does not compile, you can create a compilation failure test. This is one of the only possibilities to test that a templated class cannot be instantiated with a specific template parameter or that a <code>static_assert</code> fails.</p>
<p>KaMPIng provides a CMake helper for creating compilation failure tests. Let's look at the example of <code>mpi_datatype&lt;Datatype&gt;()</code> which should not compile for types for which there is no equivalent MPI datatype, e.g. <code>void</code> or a pointer.</p>
<p>First, we have to create a simple <code>cpp</code> file containing the code to be tested. To reduce the amount of duplicated code, the CMake macro for compilation failures supports sections. In each compilation, only one of sections (<code>POINTER</code>, <code>VOID</code>) is enabled. To test that there is no bug in the remainder of the file, we also define a <code>else</code> section for which compilation should succeed. Our CMake helper will automatically compile the file without any sections macros defined to check this.</p>
<p>This is the content of our compilation failure test for <code>mpi_datatype&lt;Datatype&gt;()</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>::kamping;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line"><span class="preprocessor">#if defined(POINTER)</span></div>
<div class="line">    <span class="comment">// Calling mpi_datatype with a pointer type should not compile.</span></div>
<div class="line">    <span class="keyword">auto</span> result = mpi_datatype&lt;int*&gt;();</div>
<div class="line"><span class="comment">// [...] more sections, e.g. function</span></div>
<div class="line"><span class="preprocessor">#elif defined(VOID)</span></div>
<div class="line">    <span class="comment">// Calling mpi_datatype with a void type should not compile.</span></div>
<div class="line">    <span class="keyword">auto</span> result = mpi_datatype&lt;void&gt;();</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="comment">// If none of the above sections is active, this file will compile successfully.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>And the CMake code to register our tests:</p>
<div class="fragment"><div class="line">kamping_register_compilation_failure_test(</div>
<div class="line">    test_mpi_datatype_unsupported_types</div>
<div class="line">    FILES test_mpi_datatype_unsupported_types.cpp</div>
<div class="line">    SECTIONS &quot;POINTER&quot; &quot;VOID&quot;</div>
<div class="line">)</div>
</div><!-- fragment --><p>If you want to link libraries other than KaMPIng, use <code>katestrophe_add_compilation_failure_test</code>.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Reference</h1>
<h2><a class="anchor" id="autotoc_md26"></a>
KampingTestHelper</h2>
<p>The CMake module <code>KaTestrophe</code> provides convenience wrappers for registering tests for KaMPIng.</p>
<div class="fragment"><div class="line"># Convenience wrapper for adding tests for KaMPIng</div>
<div class="line"># This creates the target, links googletest and kamping (which includes MPI as transitive depenency), enables warnings and registers the test.</div>
<div class="line"># The test is executed directly, wihout using `mpiexec`</div>
<div class="line">#</div>
<div class="line"># TARGET_NAME the target name</div>
<div class="line"># FILES the files of the target</div>
<div class="line">#</div>
<div class="line">kamping_register_test(target FILES [filename ...])</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Convenience wrapper for adding tests for KaMPIng which rely on MPI</div>
<div class="line"># This creates the target, links googletest, kamping and MPI, enables warnings and registers the tests.</div>
<div class="line"># The test is executed using `mpiexec`, using the number of MPI ranks specified.</div>
<div class="line">#</div>
<div class="line"># TARGET_NAME the target name</div>
<div class="line"># FILES the files of the target</div>
<div class="line"># CORES the number of MPI ranks to run the test for</div>
<div class="line">#</div>
<div class="line">kamping_register_mpi_test(target FILES [filename ...] CORES [Integer ...])</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Convenience wrapper for registering a set of tests that should fail to compile and require KaMPIng to be linked.</div>
<div class="line">#</div>
<div class="line"># TARGET prefix for the targets to be built</div>
<div class="line"># FILES the list of files to include in the target</div>
<div class="line"># SECTIONS sections of the compilation test to build</div>
<div class="line">#</div>
<div class="line">kamping_register_compilation_failure_test(&lt;target name&gt; FILES [filename ... ] SECTIONS [section ...])</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
KaTestrophe</h2>
<p>The CMake module <code>KaTestrophe</code> provides general functions for registering unit tests with <code>ctest</code>, which should be executed using <code>mpiexec</code>. They are agnostic to the library under test and do not depend on KaMPIng. You should only have to use them if you want fine control over what is linked to your test and how it is executed.</p>
<div class="fragment"><div class="line"># Adds an executable target with the specified files FILES and links gtest and the MPI gtest runner</div>
<div class="line">#</div>
<div class="line"># KATESTROPHE_TARGET target name</div>
<div class="line"># FILES the files to include in the target</div>
<div class="line">katestrophe_add_test_executable(target FILES [filename ...])</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Registers an executable target KATESTROPHE_TEST_TARGET as a test to be executed with ctest.</div>
<div class="line"># The test is executed using `mpiexec`, using the number of MPI ranks specified.</div>
<div class="line">#</div>
<div class="line"># KATESTROPHE_TEST_TARGET target name</div>
<div class="line"># CORES the number of MPI ranks to run the test with</div>
<div class="line">#</div>
<div class="line">katestrophe_add_mpi_test(target CORES [Integer ...])</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Registers a set of tests which should fail to compile.</div>
<div class="line">#</div>
<div class="line"># TARGET prefix for the targets to be built</div>
<div class="line"># FILES the list of files to include in the target</div>
<div class="line"># SECTIONS sections of the compilation test to build</div>
<div class="line"># LIBRARIES libraries to link via target_link_libraries(...)</div>
<div class="line">#</div>
<div class="line">katestrophe_add_compilation_failure_test(</div>
<div class="line">  TARGET target_prefix</div>
<div class="line">  FILES [filename ...]</div>
<div class="line">  SECTIONS [section ...]</div>
<div class="line">  LIBRARIES [library ...]</div>
<div class="line">)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">KaMPIng Documentation Overview</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
